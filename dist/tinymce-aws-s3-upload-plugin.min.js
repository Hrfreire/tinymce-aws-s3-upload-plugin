'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};tinymce.PluginManager.add('AwsS3Upload',function(a,b){function c(u){var v='number'==typeof o.min&&u.size<o.min||'number'==typeof o.max&&u.size>o.max;if(v){var w=new RangeError('The content length of \''+u.name+'\' must be between '+o.min+' and '+o.max+' bytes.');throw o.errorCallback&&'function'==typeof o.errorCallback&&o.errorCallback(w),w}}var _a$getParam=a.getParam('Awss3UploadSettings'),d=_a$getParam.bucketName,_a$getParam$folderNam=_a$getParam.folderName,i=_a$getParam$folderNam===void 0?'':_a$getParam$folderNam,f=_a$getParam.awsAuth,_a$getParam$buttonTex=_a$getParam.buttonText,j=_a$getParam$buttonTex===void 0?'Upload File':_a$getParam$buttonTex,_a$getParam$condition=_a$getParam.conditions,k=_a$getParam$condition===void 0?{}:_a$getParam$condition,g=_a$getParam.progress,h=_a$getParam.secondFileSelectedBeforeFirstUpload,l=f.secretAccessKey,m=f.accessKeyId,n=f.region,_k$contentLengthRange=k.contentLengthRange,o=_k$contentLengthRange===void 0?{min:0,max:null}:_k$contentLengthRange,p=!1;if(!d)return console.log('`bucketName` parameter missing on init AwsS3Upload TinyMCE plugin.'),!1;if(f&&'object'==('undefined'==typeof f?'undefined':_typeof(f))){if(!m)return console.log('`awsAuth` parameter missing `accessKeyId` property on init AwsS3Upload TinyMCE plugin.'),!1;if(!l)return console.log('`awsAuth` parameter missing `secretAccessKey` property on init AwsS3Upload TinyMCE plugin.'),!1;if(!n)return console.log('`awsAuth` parameter missing `secretAccessKey` property on init AwsS3Upload TinyMCE plugin.'),!1;AWS.config.update({region:n,accessKeyId:m,secretAccessKey:l})}var q=a.targetElm,r=document.createElement('input');r.type='file',r.style.cssText='display:none',q.parentNode.insertBefore(r,q);var s=document.createElement('progress');s.max=100,s.value=10,s.style.cssText='display:none',q.parentNode.insertBefore(s,q);var t=new AWS.S3({params:{Bucket:d}});r.addEventListener('change',function(u){u.preventDefault();var v=r.files[0],w=a.contentAreaContainer;if(v){c(v),w.parentNode.insertBefore(s,w),g.bar&&'boolean'==typeof g.bar&&(s.style.cssText='display:block;position: absolute;z-index: 9999;width: 120px;height: 15px;right: 10px;top:45px'),p=!0;var x=v.name.split('.').pop(),y=v.name.split('.'+x)[0],z=(i?i+'/':'')+y+'-'+Date.now()+'.'+x,A={Key:z,ContentType:v.type,Body:v,ACL:'public-read'};t.putObject(A).on('httpUploadProgress',function(B){var C=parseInt(100*(B.loaded/B.total));s.value=C,g.callback&&'function'==typeof g.callback&&g.callback(C)}).send(function(B,C){if(p=!1,s.style.cssText='display:none',B)g.errorCallback&&'function'==typeof g.errorCallback&&g.errorCallback(B);else{var D='https://'+d+'.s3.amazonaws.com/'+z;g.successCallback&&'function'==typeof g.successCallback&&g.successCallback(a,D)}})}}),a.addButton('AwsS3UploadButton',{text:j,icon:!1,onclick:function onclick(){p?h.callback&&'function'==typeof h.callback?h.callback():alert('Progress allready'):r.click()}})});
